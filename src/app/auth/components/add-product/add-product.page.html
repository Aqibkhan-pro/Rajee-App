<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-button (click)="goBack()">
        <ion-icon slot="icon-only" name="arrow-back"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>{{ 'add' | translate }} ({{ currentStep }}/{{ TOTAL_STEPS }})</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content #content class="page-content">
  <form [formGroup]="form">
    <ion-list class="form-list">
      <!-- ===================================== -->
      <!-- ✅ STEP 1: Title, Images, Category -->
      <!-- ===================================== -->
      <ng-container *ngIf="currentStep === 1">
        <!-- Title -->
        <div class="select_location">
          <div class="sub_select_location">
            <p class="location">{{ 'offer_subject' | translate }}</p>
            <ion-input
              formControlName="title"
              [placeholder]="'title' | translate"
              class="change_subject"
            ></ion-input>
          </div>
        </div>

        <!-- ✅ Images horizontal picker -->
        <ion-item class="no-pad" lines="none">
          <div class="images-row">
            <!-- picker tile -->
            <div class="pick-tile" (click)="pickMultipleImages()">
              <ion-icon name="camera-outline"></ion-icon>
              <div class="pick-text">
                {{ 'add_image' | translate }}<br />({{ pickedImages.length }}/{{ MAX_IMAGES }})
              </div>
            </div>

            <!-- horizontal scroll list -->
            <div class="picked-x" *ngIf="pickedImages.length">
              <div *ngFor="let img of pickedImages; let i = index" class="picked-card">
                <img [src]="img.dataUrl" class="picked-image" />
                <button type="button" class="remove-chip" (click)="removePickedImage(i)">
                  <ion-icon name="close"></ion-icon>
                </button>
              </div>
            </div>
          </div>
        </ion-item>

        <!-- ✅ Category & Subcategory (Bottom Sheet) -->
        <div class="select_location" (click)="openCategorySelector()">
          <div class="sub_select_location">
            <p class="location">{{ 'section' | translate }} & {{ 'sub_category' | translate }}</p>
            <div class="category-display-row">
              <span class="category-display-text" *ngIf="selectedCategoryDisplay">
                {{ selectedCategoryDisplay }}
                <span *ngIf="selectedSubCategoryDisplay"> • {{ selectedSubCategoryDisplay }}</span>
              </span>
              <span class="category-display-text placeholder" *ngIf="!selectedCategoryDisplay">
                {{ 'select_category_subcategory' | translate }}
              </span>
              <ion-icon name="chevron-forward-outline" class="chevron-icon"></ion-icon>
            </div>
          </div>
        </div>
      </ng-container>

      <!-- ===================================== -->
      <!-- ✅ STEP 2: Location, Condition, Description -->
      <!-- ===================================== -->
      <ng-container *ngIf="currentStep === 2">
        <!-- Province -->
        <div class="select_location">
          <div class="sub_select_location">
            <p class="location">{{ 'city' | translate }}</p>
            <ion-item lines="none" class="inner-light">
              <ion-select
                formControlName="province"
                [placeholder]="'select_city' | translate"
                [interfaceOptions]="{ cssClass: 'arabic' }"
              >
                <ion-select-option *ngFor="let p of provinces" [value]="p.key">
                  {{ selectedLanguage === 'en' ? p.en : p.ar }}
                </ion-select-option>
              </ion-select>
            </ion-item>
          </div>
        </div>

        <!-- District -->
        <div class="select_location">
          <div class="sub_select_location">
            <p class="location">{{ 'district' | translate }}</p>
            <ion-item lines="none" class="inner-light">
              <ion-select
                formControlName="district"
                [placeholder]="'select_district' | translate"
                [interfaceOptions]="{ cssClass: 'arabic' }"
              >
                <ion-select-option *ngFor="let d of districtOptions" [value]="d.key">
                  {{ selectedLanguage === 'en' ? d.en : d.ar }}
                </ion-select-option>
              </ion-select>
            </ion-item>
          </div>
        </div>

        <!-- Condition -->
        <div class="select_location">
          <div class="sub_select_location">
            <p class="location">{{ 'condition_label' | translate }}</p>
            <ion-item lines="none" class="inner-light">
              <ion-select
                formControlName="condition"
                [placeholder]="'select_condition' | translate"
                [interfaceOptions]="{ cssClass: 'arabic' }"
              >
                <ion-select-option *ngFor="let c of conditions" [value]="c">
                  {{ c }}
                </ion-select-option>
              </ion-select>
            </ion-item>
          </div>
        </div>

        <!-- Description -->
        <div class="select_location">
          <div class="sub_select_location">
            <p class="location">{{ 'description_label' | translate }}</p>
            <ion-textarea
              formControlName="description"
              [placeholder]="'description' | translate"
              class="change_subject"
              rows="4"
              [autoGrow]="true"
            ></ion-textarea>
          </div>
        </div>
      </ng-container>

      <!-- ===================================== -->
      <!-- ✅ STEP 3: Contact Phone & Price -->
      <!-- ===================================== -->
      <ng-container *ngIf="currentStep === 3">
        <!-- Contact Phone -->
        <div class="select_location">
          <div class="sub_select_location">
            <p class="location">{{ 'phone' | translate }}</p>
            <ion-input
              formControlName="contactPhone"
              type="tel"
              [placeholder]="'phone_placeholder' | translate"
              class="change_subject"
            ></ion-input>
          </div>
        </div>

        <!-- Price -->
        <div class="select_location">
          <div class="sub_select_location">
            <p class="location">{{ 'price' | translate }}</p>
            <ion-input
              formControlName="price"
              type="number"
              [placeholder]="'price_placeholder' | translate"
              class="change_subject"
            ></ion-input>
          </div>
        </div>
      </ng-container>
    </ion-list>
  </form>
</ion-content>

<!-- ===================================== -->
<!-- ✅ Sticky footer with navigation -->
<!-- ===================================== -->
<div class="submit-bar">
  <div class="step-actions" *ngIf="currentStep < TOTAL_STEPS">
    <ion-button
      *ngIf="currentStep > 1"
      fill="outline"
      class="back-btn"
      (click)="prevStep()"
    >
      {{ 'back' | translate }}
    </ion-button>
    <ion-button
      fill="solid"
      class="next-btn"
      (click)="nextStep()"
    >
      {{ 'next' | translate }}
    </ion-button>
  </div>

  <div class="step-actions" *ngIf="currentStep === TOTAL_STEPS">
    <ion-button
      fill="outline"
      class="back-btn"
      (click)="prevStep()"
    >
      {{ 'back' | translate }}
    </ion-button>
    <ion-button
      fill="solid"
      class="submit-btn"
      (click)="handleSubmit()"
    >
      {{ 'submit' | translate }}
    </ion-button>
  </div>
</div>
