<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button (click)="goBack()" style="color: var(--secondary-color) !important;"></ion-back-button>
    </ion-buttons>
    <ion-title>{{ 'add' | translate }}</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="page-content">
  <form [formGroup]="form" (ngSubmit)="handleSubmit()">
    <ion-list class="form-list">

      <!-- ✅ MULTIPLE IMAGE PICKER (MAX 3) + HORIZONTAL LIST -->
      <ion-item lines="none" class="no-pad">
        <div class="images-row">

          <!-- picker tile -->
          <button
            type="button"
            class="pick-tile"
            *ngIf="pickedImages.length < 3"
            (click)="pickMultipleImages()">
            <ion-icon name="camera"></ion-icon>
            <span class="pick-text">
              {{ 'add_image' | translate }} ({{ pickedImages.length }}/3)
            </span>
          </button>

          <!-- ✅ horizontal picked images -->
          <div class="picked-x" *ngIf="pickedImages.length">
            <div class="picked-card" *ngFor="let img of pickedImages; let i = index">
              <img [src]="img.dataUrl" class="picked-image" alt="picked-image" />

              <button
                type="button"
                class="remove-chip"
                (click)="removePickedImage(i)">
                <ion-icon name="close"></ion-icon>
              </button>
            </div>
          </div>

        </div>
      </ion-item>

      <!-- ✅ Location (with map picker button) -->
      <ion-item lines="none" class="no-pad">
        <div class="select_location">
          <div class="sub_select_location">
            <ion-text class="location" [style.text-align]="selectedLanguage=='en' ? 'start':'end'">
              {{ 'location' | translate }}
            </ion-text>

            <ion-item lines="none" class="inner-light" *ngIf="productLocation; else checkPermission">
              <ion-label>
                Lat: {{ productLocation.lat | number:'1.6-6' }},
                Lng: {{ productLocation.lng | number:'1.6-6' }}
              </ion-label>

              <ion-button
                type="button"
                fill="clear"
                (click)="openMapPicker()"
                [slot]="selectedLanguage=='en' ? 'end' : 'start'">
                <ion-icon name="location-outline"></ion-icon>
              </ion-button>
            </ion-item>

            <ng-template #checkPermission>
              <p style="color:var(--text-black)">Please Check Permission</p>
            </ng-template>

          </div>
        </div>
      </ion-item>

      <!-- ✅ City / Province -->
      <ion-item lines="none" class="no-pad">
        <div class="select_location">
          <div class="sub_select_location">
            <ion-text class="subject" [style.text-align]="selectedLanguage=='en' ? 'start':'end'">
              {{ 'city' | translate }}
            </ion-text>

            <ion-select
              formControlName="province"
              interface="popover"
              class="change_subject arabic"
              [slot]="selectedLanguage=='en' ? 'end':'start'"
              [style.text-align]="selectedLanguage=='en' ? 'start':'end'">

              <ion-select-option *ngFor="let p of provinces" [value]="p.key">
                {{ selectedLanguage === 'en' ? p.en : p.ar }}
              </ion-select-option>

            </ion-select>
          </div>
        </div>
      </ion-item>

      <!-- ✅ District (depends on City/Province) -->
      <ion-item lines="none" class="no-pad">
        <div class="select_location">
          <div class="sub_select_location">
            <ion-text class="subject" [style.text-align]="selectedLanguage=='en' ? 'start':'end'">
              {{ 'district' | translate }}
            </ion-text>

            <ion-select
              formControlName="district"
              interface="popover"
              class="change_subject arabic"
              [disabled]="!districtOptions?.length"
              [slot]="selectedLanguage=='en' ? 'end':'start'"
              [style.text-align]="selectedLanguage=='en' ? 'start':'end'">

              <ion-select-option *ngFor="let d of districtOptions" [value]="d.key">
                {{ selectedLanguage === 'en' ? d.en : d.ar }}
              </ion-select-option>

            </ion-select>
          </div>
        </div>
      </ion-item>

      <!-- ✅ Phone Number input -->
      <ion-item lines="none" class="no-pad">
        <div class="select_location">
          <div class="sub_select_location">
            <ion-text class="subject" [style.text-align]="selectedLanguage=='en' ? 'start':'end'">
              {{ 'phone' | translate }}
            </ion-text>

            <ion-input
              class="change_subject"
              formControlName="contactPhone"
              inputmode="tel"
              type="tel"
              placeholder="e.g: 05XXXXXXXX"
              [style.text-align]="selectedLanguage=='en' ? 'start':'end'">
            </ion-input>
          </div>
        </div>
      </ion-item>

      <!-- Title / Subject -->
      <ion-item lines="none" class="no-pad">
        <div class="select_location">
          <div class="sub_select_location">
            <ion-text class="subject" [style.text-align]="selectedLanguage=='en' ? 'start':'end'">
              {{ 'offer_subject' | translate }}
            </ion-text>

            <ion-input
              class="change_subject"
              formControlName="title"
              placeholder="e.g: Honda 125"
              [style.text-align]="selectedLanguage=='en' ? 'start':'end'">
            </ion-input>
          </div>
        </div>
      </ion-item>

      <!-- Price -->
      <ion-item lines="none" class="no-pad">
        <div class="select_location">
          <div class="sub_select_location">
            <ion-text class="subject" [style.text-align]="selectedLanguage=='en' ? 'start':'end'">
              {{ 'price' | translate }}
            </ion-text>

            <ion-input
              class="change_subject"
              type="number"
              formControlName="price"
              placeholder="e.g: 100"
              [style.text-align]="selectedLanguage=='en' ? 'start':'end'">
            </ion-input>
          </div>
        </div>
      </ion-item>

      <!-- Section -->
      <ion-item lines="none" class="no-pad">
        <div class="select_location">
          <div class="sub_select_location">
            <ion-text class="subject" [style.text-align]="selectedLanguage=='en' ? 'start':'end'">
              {{ 'section' | translate }}
            </ion-text>

            <ion-select
              formControlName="section"
              interface="popover"
              class="change_subject arabic"
              [slot]="selectedLanguage=='en' ? 'end':'start'"
              [style.text-align]="selectedLanguage=='en' ? 'start':'end'">

              <ion-select-option *ngFor="let s of category" [value]="s.key">
                {{ selectedLanguage === 'en' ? s.en : s.ar }}
              </ion-select-option>

            </ion-select>
          </div>
        </div>
      </ion-item>

      <!-- ✅ Sub Category -->
      <ion-item lines="none" class="no-pad">
        <div class="select_location">
          <div class="sub_select_location">
            <ion-text class="subject" [style.text-align]="selectedLanguage=='en' ? 'start':'end'">
              {{ 'sub_category' | translate }}
            </ion-text>

            <ion-select
              formControlName="subCategory"
              interface="popover"
              class="change_subject arabic"
              [disabled]="!subCategoryOptions?.length"
              [slot]="selectedLanguage=='en' ? 'end':'start'"
              [style.text-align]="selectedLanguage=='en' ? 'start':'end'">

              <ion-select-option *ngFor="let sc of subCategoryOptions" [value]="sc.key">
                {{ selectedLanguage === 'en' ? sc.en : sc.ar }}
              </ion-select-option>

            </ion-select>
          </div>
        </div>
      </ion-item>

      <!-- Condition -->
      <ion-item lines="none" class="no-pad">
        <div class="select_location">
          <div class="sub_select_location">
            <ion-text class="subject" [style.text-align]="selectedLanguage=='en' ? 'start':'end'">
              {{ 'condition_label' | translate }}
            </ion-text>

            <ion-select
              formControlName="condition"
              interface="popover"
              class="change_subject arabic"
              [slot]="selectedLanguage=='en' ? 'end':'start'"
              [style.text-align]="selectedLanguage=='en' ? 'start':'end'">

              <ion-select-option *ngFor="let c of conditions" [value]="c">
                {{ c }}
              </ion-select-option>

            </ion-select>
          </div>
        </div>
      </ion-item>

      <!-- Description -->
      <ion-item lines="none" class="no-pad">
        <div class="select_location">
          <div class="sub_select_location">
            <ion-text class="subject" [style.text-align]="selectedLanguage=='en' ? 'start':'end'">
              {{ 'description_label' | translate }}
            </ion-text>

            <ion-textarea
              class="change_subject"
              formControlName="description"
              placeholder="{{ 'enter_description' | translate }}"
              [style.text-align]="selectedLanguage=='en' ? 'start':'end'">
            </ion-textarea>

          </div>
        </div>
      </ion-item>

    </ion-list>

    <!-- ✅ STICKY SAFE-AREA SUBMIT -->
    <div class="submit-bar">
      <ion-button expand="block" mode="ios" type="submit" class="submit-btn">
        {{ 'submit' | translate }}
      </ion-button>
    </div>

  </form>
</ion-content>
