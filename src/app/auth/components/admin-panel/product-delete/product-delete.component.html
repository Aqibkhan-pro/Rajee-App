<ion-header class="ion-no-border">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button style="color: var(--secondary-color) !important;"></ion-back-button>
    </ion-buttons>
    <ion-title class="page-title">Remove Products</ion-title>
  </ion-toolbar>

  <ion-toolbar>
    <ion-searchbar
      mode="ios"
      class="searchbar"
      placeholder="Search approved products..."
      (ionInput)="onSearch($event)">
    </ion-searchbar>
  </ion-toolbar>
</ion-header>

<ion-content class="page-content">

  <ion-refresher slot="fixed" (ionRefresh)="doRefresh($event)">
    <ion-refresher-content pullingIcon="chevron-down-circle-outline"></ion-refresher-content>
  </ion-refresher>

  <div class="list-container">

    <!-- Loading Skeleton -->
    <ng-container *ngIf="loading">
      <ion-card class="product-card" *ngFor="let x of [1,2,3,4]" mode="ios">
        <ion-item lines="none" class="card-item">
          <ion-thumbnail slot="start" class="thumb">
            <ion-skeleton-text animated style="width: 88px; height: 88px;"></ion-skeleton-text>
          </ion-thumbnail>

          <ion-label class="card-body">
            <ion-skeleton-text animated style="width: 70%; height: 14px;"></ion-skeleton-text>
            <ion-skeleton-text animated style="width: 45%; height: 12px; margin-top: 10px;"></ion-skeleton-text>
            <ion-skeleton-text animated style="width: 90%; height: 10px; margin-top: 12px;"></ion-skeleton-text>
          </ion-label>
        </ion-item>

        <div class="card-actions">
          <ion-skeleton-text animated style="width: 120px; height: 34px; border-radius: 10px;"></ion-skeleton-text>
        </div>
      </ion-card>
    </ng-container>

    <!-- List -->
    <ng-container *ngIf="!loading">
      <ion-card
        class="product-card"
        *ngFor="let p of filteredProducts; trackBy: trackById"
        mode="ios">

        <ion-item lines="none" class="card-item">
          <ion-thumbnail slot="start" class="thumb">
            <img [src]="p?.image || p?.images?.[0]" (error)="onImgError($event)"  />
          </ion-thumbnail>

          <ion-label class="card-body">
            <div class="top-row">
              <div class="title">{{ p.title || 'Untitled' }}</div>
              <ion-chip class="status-chip" color="success">
                <ion-icon name="checkmark-circle-outline"></ion-icon>
                <ion-label>Approved</ion-label>
              </ion-chip>
            </div>

            <div class="chips-row">
              <ion-chip class="chip">
                <ion-icon name="pricetag-outline"></ion-icon>
                <ion-label>{{ p.price || 'N/A' }}</ion-label>
              </ion-chip>

              <ion-chip class="chip" *ngIf="p.section">
                <ion-icon name="grid-outline"></ion-icon>
                <ion-label>{{ p.section }}</ion-label>
              </ion-chip>

              <ion-chip class="chip">
                <ion-icon name="time-outline"></ion-icon>
                <ion-label>{{ getProductTime(p) | date:'dd MMM yyyy' }}</ion-label>
              </ion-chip>
            </div>

            <div class="desc" *ngIf="p.description">{{ p.description }}</div>

            <div class="user-row" *ngIf="p.user?.name">
              <ion-icon name="person-outline"></ion-icon>
              <span>{{ p.user?.name }}</span>
            </div>
          </ion-label>
        </ion-item>

        <div class="card-actions">
          <ion-button class="btn-delete" color="danger" fill="solid" (click)="confirmDelete(p)">
            <ion-icon name="trash-outline" slot="start"></ion-icon>
            Remove
          </ion-button>
        </div>
      </ion-card>

      <!-- Empty -->
      <div class="empty" *ngIf="filteredProducts.length === 0">
        <ion-icon name="cube-outline"></ion-icon>
        <p>No approved products found</p>
      </div>
    </ng-container>

  </div>

</ion-content>
