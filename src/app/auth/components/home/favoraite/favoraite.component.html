<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button></ion-back-button>
    </ion-buttons>
    <ion-title>{{ 'favorites' | translate }}</ion-title>
  </ion-toolbar>
  <ion-toolbar>
    <ion-searchbar
      [(ngModel)]="searchTerm"
      (ionInput)="filterFavorites()"
      [placeholder]="'search_favorites' | translate"
      mode="ios">
    </ion-searchbar>
  </ion-toolbar>
</ion-header>

<ion-content id="main-content">
  <!-- Card List -->
  <div class="card-container">
    <ion-card *ngFor="let item of filteredItems" mode="ios">
      <ion-item class="card-item" lines="none" (click)="onCardClick(item)">

        <img [src]="(item?.images?.[0] || item?.image || 'assets/images/img/usr.png')" [alt]="item?.title"
          class="card-image" />

        <div class="card-details">

          <div class="card-title" [attr.dir]="(item.title | isArabic) ? 'rtl' : 'ltr'"
            [style.text-align]="(item.title | isArabic) ? 'right' : 'left'">
            {{ item.title }}
          </div>

          <div class="card-row">
            <div class="price-pill">
              <ion-icon name="pricetag-outline"></ion-icon>
              <span style="margin-top: 6px;">{{ item.price }}</span>
            </div>

            <div class="meta">
              <ion-icon name="time-outline"></ion-icon>
              <span style="margin-top: 4px;">{{ item.time | date :'dd MMM yy' }}</span>
            </div>
          </div>

          <div class="card-row">
            <div class="meta">
              <ion-icon name="location-outline"></ion-icon>
              <span *ngIf="item?.provinceName">
                {{ selectedLanguage === 'en' ? item.provinceName?.en : item.provinceName?.ar }}
              </span>

              <span *ngIf="!item?.provinceName">N/A</span>

            </div>

            <div class="user">
              <span class="initial-circle">{{ item.user?.name?.charAt(0) }}</span>
              <span class="user-name" style="color:var(--text-black)">{{ item.user?.name }}</span>
            </div>
          </div>

          <!-- <div class="card-row" *ngIf="item?.comments?.length > 0">
            <div class="meta comments">
              <ion-icon name="chatbubbles"></ion-icon>
              <span>{{ item?.comments?.length }}</span>
            </div>
          </div> -->

        </div>

      </ion-item>
    </ion-card>

    <!-- Empty State -->
    <div *ngIf="filteredItems.length === 0 && !isLoading" class="empty-state">
      <ion-icon name="heart-outline" size="large"></ion-icon>
      <h3>{{ 'no_favorites' | translate }}</h3>
      <p>{{ 'no_favorites_message' | translate }}</p>
      <ion-button mode="ios" shape="round" (click)="goToHome()">
        {{ 'browse_products' | translate }}
      </ion-button>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading-state">
      <ion-spinner name="crescent"></ion-spinner>
      <p>{{ 'loading_favorites' | translate }}</p>
    </div>
  </div>
</ion-content>
